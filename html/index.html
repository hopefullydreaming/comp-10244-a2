<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- StAuth10244: I Hope Hemingway, 000912927 certify that this material is my original work. No other person's work has been used without due acknowledgement. I have not made my work available to anyone else -->
		<title>Geolocations</title>
        <style>
            #map {
                height: 600px;
                width: 900px;
            }
        </style>
        <script src="locations.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        
    </head>
	<body>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAtGHD4E6-5Fy79PTty_Oc4YYbpqmGryGw&loading=async&callback=initMap&libraries=marker"></script>


        <div id="map"></div>
        <br>
        <button type="button" class="btn btn-primary" id="geolocate" onclick="getlocations()">Geolocate</button>
        <button type="button" class="btn btn-primary" id="museums">Museums</button>
        <button type="button" class="btn btn-primary" id="movie_theaters">Movie Theaters</button>
        <button type="button" class="btn btn-primary" id="restaurants">Restaurants</button>
        <button type="button" class="btn btn-primary" id="display_all">Display All</button>
        
        <script>
            let map;
            let locationSet = false;

            function initMap(){
        
                map = new google.maps.Map(document.getElementById("map"),
                {
                    center: {lat: 43.2389, lng: -79.8224},
                    zoom: 12, 
                    mapId: "895386cccba8ae60"
                })
                

                let infoWindow = new google.maps.InfoWindow({
                    content: "",
                });

                let marker_clicked = function() {

                    
                    infoWindow.close(); 
                    contentString = `<h3>${this.NAME}</h3>
                                     <p>${this.ADDRESS}</p>
                                     <button type="button" class="btn btn-primary" id="directions">Get Directions</button>`
                    infoWindow.setContent(contentString);
                    infoWindow.open(map, this);
                }

                for (i = 0; i < locations.length; i++){
                    if (locations[i].CATEGORY == "Museum")
                        new_icon = "http://maps.google.com/mapfiles/kml/paddle/grn-blank.png";
                    else if (locations[i].CATEGORY == "Restaurant")
                        new_icon = "http://maps.google.com/mapfiles/kml/paddle/pink-blank.png";
                    else if (locations[i].CATEGORY == "Movie-Theatre")
                        new_icon = "http://maps.google.com/mapfiles/kml/paddle/ylw-blank.png";
                    else 
                        new_icon = "http://maps.google.com/mapfiles/kml/paddle/blu-blank.png";

                    // create the icon element
                    const icon_content = document.createElement("img");
                    icon_content.src = new_icon;

                    new_marker = new google.maps.marker.AdvancedMarkerElement({
                    map: map,
                    position: {lat: locations[i].LATITUDE,  
                            lng: locations[i].LONGITUDE
                            },
                    title: locations[i].NAME, 
                    content: icon_content
                    });
                    new_marker.NAME = locations[i].NAME;
                    new_marker.ADDRESS = locations[i].ADDRESS;
        
                    new_marker.addListener('click', marker_clicked);

                }
    
            }

            function showPosition(position) {

                const icon_content = document.createElement("img");
                icon_content.src = "http://maps.google.com/mapfiles/kml/paddle/blu-blank.png";
                locationSet = true;

                // create a marker centered at the user's location
                let user_location = new google.maps.marker.AdvancedMarkerElement({
                    map: map,
                    position: { lat: position.coords.latitude, 
                                lng: position.coords.longitude
                            },
                    title: "Your Location",  
                    content: icon_content
                });
            }

            function showError(error) {
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        console.log("locations Permission Denied")
                        break;
                    case error.POSITION_UNAVAILABLE:
                        console.log("locations Information Unavailable.")
                        break;
                    case error.TIMEOUT:
                        console.log("Request Timed Out")
                        break;
                    case error.UNKNOWN_ERROR:
                        console.log("An Unknown Error Occurred.")
                        break;
                
                }
            }

            function getlocations() {
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition, showError)
                } else {
                    console.log("Geolocations is not supported by this browser.")
                }
            }
            
        </script>
    </body>
</html>
  